// Note: async/await code - formatting skipped for edition compatibility
use super::super::services::payment_service::PaymentService;
use super::super::dtos::payment_dto::CreatePaymentDto;
# [derive (Default , Debug , Clone , PartialEq , serde :: Serialize , serde :: Deserialize)] # [serde (rename_all = "camelCase")] pub struct PaymentController { pub payment_service : std :: sync :: Arc < PaymentService > }
# [axum :: async_trait] impl < S > axum :: extract :: FromRequestParts < S > for PaymentController where S : Send + Sync { type Rejection = std :: convert :: Infallible ; async fn from_request_parts (parts : & mut axum :: http :: request :: Parts , state : & S) -> Result < Self , Self :: Rejection > { let axum :: Extension (controller) = axum :: Extension :: < std :: sync :: Arc < Self >> :: from_request_parts (parts , state) . await . expect ("Controller extension missing") ; Ok (controller . as_ref () . clone ()) } }
impl PaymentController { pub fn new (payment_service : std :: sync :: Arc < PaymentService >) -> Self { Self { payment_service : payment_service } } pub fn new_di (payment_service : std :: sync :: Arc < PaymentService >) -> Self { Self { payment_service : payment_service } } # [doc = concat ! ("Route: " , "POST" , " " , "/")] pub async fn create (self , axum :: Json (dto) : axum :: Json < CreatePaymentDto >) -> Result < String , crate :: AppError > { return Ok (self . payment_service . clone () . process (dto) . await ? . into ()) ; } # [doc = concat ! ("Route: " , "GET" , " " , "/health")] pub async fn health (self) -> Result < String , crate :: AppError > { return Ok (String :: from ("OK") . into ()) ; } pub fn router () -> axum :: Router { axum :: Router :: new () . route ("/payments" , axum :: routing :: post (Self :: create)) . route ("/payments/health" , axum :: routing :: get (Self :: health)) } }
